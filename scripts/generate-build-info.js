#!/usr/bin/env node

/**
 * Generate build metadata for Netlify deployments
 * This script injects version from package.json and deployment date into environment.prod.ts
 * 
 * Version Management:
 * - Update version in package.json before committing
 * - Follow semantic versioning: MAJOR.MINOR.PATCH
 * - Major: Breaking changes or new major features
 * - Minor: New features, enhancements (non-breaking)
 * - Patch: Bug fixes, minor tweaks
 */

const fs = require('fs');
const path = require('path');

// Read version from package.json
const version = require('../package.json').version;
const deployTime = new Date().toISOString();
const isProduction = process.env.CONTEXT === 'production';

// Create the environment.prod.ts content
const envContent = `// This file is auto-generated by scripts/generate-build-info.js during Netlify deployment
// Do not edit manually - changes will be overwritten on next build

export const environment = {
  production: true,
  googleClientId: '415057442876-1lpa3bgneif4l2gnd6g1anml9o49hl0l.apps.googleusercontent.com',
  
  // Build metadata
  build: {
    version: '${version}',
    deployDate: '${deployTime}',
    isProduction: ${isProduction}
  }
};
`;

// Write to environment.prod.ts
const envPath = path.join(__dirname, '../src/environments/environment.prod.ts');
fs.writeFileSync(envPath, envContent, 'utf8');

console.log('âœ… Build metadata generated successfully!');
console.log(`   Version: ${version}`);
console.log(`   Deploy Date: ${deployTime}`);
console.log(`   Production: ${isProduction}`);
